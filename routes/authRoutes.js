import express from 'express';
import authController, { upload as userUpload } from '../controllers/authController.js';
import { authenticateToken, requireRole, requireVerified } from '../middleware/auth.js';

const router = express.Router();

// üîì –ü—É–±–ª–∏—á–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã (–Ω–µ —Ç—Ä–µ–±—É—é—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏)
router.post('/register', authController.register);
router.post('/login', authController.login);
router.get('/verify-email', authController.verifyEmail);
router.post('/resend-verification', authController.resendVerification);
router.post('/forgot-password', authController.forgotPassword);
router.post('/reset-password', authController.resetPassword);

// üîê –ó–∞—â–∏—â–µ–Ω–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã (—Ç—Ä–µ–±—É—é—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏)

// –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–µ–∫—É—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ - –≤—Å–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ
router.get('/me', authenticateToken, authController.getMe);

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è - –≤—Å–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∏ –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ
router.put('/profile', 
    authenticateToken, 
    requireVerified,
    requireRole(['admin', 'moderator', 'seller', 'customer']),
    userUpload.single('avatar'), 
    authController.updateProfile
);

// –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è - –≤—Å–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ
router.put('/change-password', 
    authenticateToken, 
    requireRole(['admin', 'moderator', 'seller', 'customer']),
    authController.changePassword
);

// –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –ø–æ ID - –∞–¥–º–∏–Ω—ã –∏ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä—ã
router.get('/user/:id', 
    authenticateToken, 
    requireRole(['admin', 'moderator']),
    authController.getUserProfile
);

// –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π - —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω—ã
router.get('/search', 
    authenticateToken, 
    requireRole(['admin']),
    authController.searchUsers
);

// –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π - –∞–¥–º–∏–Ω—ã –∏ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä—ã
router.get('/stats/registrations', 
    authenticateToken, 
    requireRole(['admin', 'moderator']),
    authController.getRegistrationStats
);

// –≠–∫—Å–ø–æ—Ä—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω—ã)
router.get('/export', 
    authenticateToken, 
    requireRole(['admin']),
    authController.exportUsers
);

export default router;